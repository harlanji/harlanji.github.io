---
layout: post
title: Javascript Dependency System using Maven + YUI Loader
date: 2008-06-30
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
I started thinking a while back about how to create a repository of Javascript libraries / applications using Maven for decentralized transitive dependency management. The progression of things that has led to these thoughts are <a href="http://maven.apache.org/">Maven</a>, <a href="http://mojo.codehaus.org/javascript-maven-tools/">Maven JS Tools</a> (<a href="http://jira.codehaus.org/browse/MOJO-1139">feature request</a>), <a href="http://code.google.com/apis/ajaxlibs/">Google AJAX Libraries API</a>, and <a href="http://developer.yahoo.com/yui/yuiloader">YUI Loader</a>.<br /><br />My initial thoughts include using the Maven JS Tools plugin to build Javascript libraries in the same fashion as library jars for Java. These can be pushed to an external Maven repository and synced with the central repository.<br /><br />A daemon could then pull Javascript artifacts from the central repository and process them. This would include extraction, building dependency meta-data for YUI Loader so that it could discover dependencies and download them as needed, and making both items available on a public HTTP server using YUI Loader's layout conventions.<br /><br />On the client side, there would exist a MavenLoader model as a module loaded YUI Loader as normal. It would use <a href="http://developer.yahoo.com/yui/yuiloader/">addModule()</a> like:<br /><pre>loader.addModule({<br />name: "mavenloader",<br />type: "js",<br />fullpath: "http://jsrepo.maven.apache.org/mavenloader/mavenloader.js"<br />});<br /><br />// pull in the mavenLoader module now<br />loader.insert();<br /></pre><br />From this point, you could create a new MavenLoader as a decorator for YUILoader:<br /><br /><pre>//Add the module to YUILoader<br />var mavenLoader = new MavenLoader({<br />loader: loader,<br />// maybe this can be inferred based on the loaded mavenloader?<br />repopath: "http://jsrepo.maven.apache.org/"<br />});<br /><br />mavenLoader.require( "com.soashable:xmpp4js:1.0-SNAPSHOT" );<br />// or<br />mavenLoader.require({<br />groupId: "com.soashable",<br />artifactId: "xmpp4js",<br />version: "1.0-SNAPSHOT"<br />});<br /></pre> The meta-data that the repo adds to the Javascript artifacts would call register() and addModule() just like regular yui modules work, except it would be on MavenLoader and actually wrap the YUI Loader functionality under the hood:<br /><pre>mavenLoader.addModule({<br />groupId: "com.soashable",<br />artifactId: "xmpp4js",<br />version: "1.0-SNAPSHOT",<br />requires: [{groupId: "com.prototype", artifactId: "prototype", version: "1.5.1"}]<br />});<br /><br />// ...<br /><br />MavenLoader.register({<br />groupId: "com.soashable",<br />artifactId: "xmpp4js",<br />version: "1.0-SNAPSHOT"<br />}, YAHOO.xmpp4js.Module);</pre><br />At this point, a call to the normal YUI Loader's insert() method should pull in all Maven dependencies transitively, with tranitive modules being added, registered and included recursively.<br /><br />This is of course rough speculation, but my initial experimentation leads me to belieive that this system should be possible.</div>
