---
layout: post
title: Jabber DataForms
date: 2007-08-14
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
Last night I whipped up an implementation of Data Forms for XMPP (<a href="http://www.xmpp.org/extensions/xep-0004.html">XEP-0004</a>). My implementation includes a reusable class for manipulating a given Data Form, an XSL sheet that generates an HTML form directly from a Data Form element, and a DataFormWindow class to bind the two together.<br /><br />The whole implementation is complete minus two parts: 1) the ability to intelligently populate "jid-single" and "jid-multi" fields, and 2) the ability to manipulate or render "data set" style results. The latter will be a shortcoming eventually, but the API is such that it won't be difficult to add. I admit, I didn't read the full spec at the time I started implementing, and that is why that functionality lacks. Another shortcoming is that as-of right now it only works in Mozilla (as does most of Soashable; I hate dealing with tedious cross-browser issues :\).<br /><br />The XSL for rendering the form is pretty nifty, if I do say so myself. Basically it will transform this:<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_eS8rwzJcHas/RsG09bIV0sI/AAAAAAAAAA0/1FlCQgUi2RU/s1600-h/src.png"><img style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer;" src="http://2.bp.blogspot.com/_eS8rwzJcHas/RsG09bIV0sI/AAAAAAAAAA0/1FlCQgUi2RU/s320/src.png" alt="" id="BLOGGER_PHOTO_ID_5098555220507873986" border="0" /></a><br /><br />into this:<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_eS8rwzJcHas/RsG09bIV0tI/AAAAAAAAAA8/OMSTdj231tg/s1600-h/rendered.png"><img style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer;" src="http://2.bp.blogspot.com/_eS8rwzJcHas/RsG09bIV0tI/AAAAAAAAAA8/OMSTdj231tg/s320/rendered.png" alt="" id="BLOGGER_PHOTO_ID_5098555220507874002" border="0" /></a><br /><br />It still needs some work with things like selecting values and the like, but I may just delegate that out to the Javascript DataFormWindow where the Submit event is handled, etc. And to be structured more semantically so that CSS can make it look better. For now, I'm just happy that it works.<br /><br />These forms are currently used for in-band registration as well as user search, but they can be put into any arbitrary message originating between any peer. Imagine configuring your server or sending your friend a quiz through messenger. Having a dinner party? Just multi-cast an RSVP form out to your roster. This could be tied in with a calendar application or anything. Sweet? sch'yea.<br /><br />Lessons learned, etc? The XSL sheet took no more than an hour, an the Javascript behind it no more than an hour more. But somehow development ended up taking around five hours; why? As is often the case, documentation wasn't as clear as it could have been for my edge case. I was passing a DOM element into Gecko's XSLTProcessor.transformToDocument method expecting that it would be treated as a root element. Instead, only the child nodes were being processed and because of this the processor thought it was a "multi root node" document and added a <transformiiz:result> root element which seemed to replace my root element. I was confused because the same XML with the same XSL worked using an xml-stylesheet processing instruction through the browser. It definitely shouldn't have taken as long as it did to solve, and actually I was in the process of putting together a stripped down example to share with the mailing list when suddenly it started working. "The best way to learn is to teach," yet again.</div>
