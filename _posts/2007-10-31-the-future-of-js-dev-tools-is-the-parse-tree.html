---
layout: post
title: The Future of JS Dev Tools Is The Parse Tree
date: 2007-10-31
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
<p style="margin-bottom: 0in; line-height: 150%;"> Today I read an article from Sun research, entitled <a href="http://research.sun.com/techrep/2007/abstract-168.html">Using Javascript as a Real Programming Language</a>. This obviously struck a chord with me, because it talks about <a href="http://blog.devspan.com/2007/10/maven-javascript-plugin.html">exactly the stuff I've been pushing for</a> since I started using it as a real programming language, a few months ago. Recently, I have been collaborating with a fellow from the Maven list who is building a <a href="http://hammerfest.sourceforge.net/maven-javascript-plugin/">Javascript packaging plug-in for Maven</a>, and trying to integrate all the features from the late JSLibBuilder.</p> <p style="margin-bottom: 0in; line-height: 150%;"> One point I've been touching on lately is that <a href="http://en.wikipedia.org/wiki/Code_coverage">code coverage testing</a> is <i>the</i> key to the sanity of any code base written in a dynamic language (<a href="http://blog.devspan.com/2007/05/testing-rails-first-impression.html">same point applies to rails</a>). While <a href="http://www-128.ibm.com/developerworks/java/library/j-cq01316/index.html">having 100% coverage can be fool's gold</a>, it is a good measure of which code needs to be better exercised by tests.  </p> <p style="margin-bottom: 0in; line-height: 150%;"> My research has found me one complete tool for doing such a thing in Javascript: <a href="http://siliconforks.com/jscoverage/">JSCoverage</a>. It runs on the command line and instruments specified code to see which lines were executed. Basically what it does is add a Javascript function call on every other line, and when it is runs its special runner, it produces a report with annotated code coverage data.  In unison with JSUnit, this gives the same sort of functionality as Java tools like <a href="http://cobertura.sourceforge.net/">Cobertura</a> + JUnit (though, AFAIK it is only line coverage, not branch coverage).</p> <p style="margin-bottom: 0in; line-height: 150%;"> I'd have liked to have integrated it with JSLibBuilder or javascript-maven-plugin, but because it is written in C (based on <a href="http://www.mozilla.org/js/spidermonkey/">Spider Monkey</a>), distribution would be hell. So I was doing <a href="http://del.icio.us/harlanji/javascript">some research</a> to see if I could find an alternative Javascript parser that runs in Java or Javascript to port JSCoverage to, and came across a piece of gold: <a href="http://lxr.mozilla.org/mozilla/source/js/narcissus/">Narcissus</a>, a Javascript interpreter written in Javascript. It is also, incidentally, based on Spider Monkey :). Easy porting of JSCoverage? I hope so. The reason a tool written in a Java friendly language is important is because it would be able to run during a Maven build, and be distributed through the central Maven repository.</p> <p style="margin-bottom: 0in; line-height: 150%;"> Let me backtrack a little: the best Javascript code monkeying tools available right now are <a href="http://dojotoolkit.org/docs/shrinksafe">Dojo Shrinksafe</a> and <a href="http://www.julienlecomte.net/blog/2007/08/13/introducing-the-yui-compressor/">YUI Compressor</a> (from a strictly 'safety' standpoint, others have achieved better compression ratios), for the simple fact that they are based on the Rhino Javascript engine, rather than relying on regular expressions and other potentially flaky methods to parse. Because source files are parsed and modified as they are serialized from a real Javascript parse tree, <a href="http://alex.dojotoolkit.org/shrinksafe/">the engines produce 100% safe results</a>. Naturally I wanted to see what else I could do with the parse tree available at runtime (cyclomatic complexity and other code analysis), but it turns out there is no public API for  accessing the parse tree in Rhino(!), and no plans to implement one.  </p> <p style="margin-bottom: 0in; line-height: 150%;"> I only have to wonder whether anyone knows about Narcissus and there is a problem with it, or if it is just sitting there waiting to be discovered (it looks like it's been around since at least 2004). If Javascript is ever to be a first class language as people are treating it, it needs first class tools. This single tool is the key to getting so much more out of Javascript.<br /></p><p style="margin-bottom: 0in; line-height: 150%;">I'll surely be writing about this more.</p></div>
